{% load staticfiles %}
{% load mathtags %}
{% with product=result %}

<div class="records_panel_wrapper" data-records-count="{{ product.records|length }}">
    <div class="records_toogle_switcher up"></div>
    <div class="records_panel">
        <div class="records_headers">
            <div class="header_box"><div class="sortable">Księgarnie</div></div>
            <div class="header_box"><div class="sortable">Liczba formatów</div></div>
            <div class="header_box">Dodatkowe Informacje</div>
            <div class="header_box">Sposób płatności</div>
            <div class="header_box"><div class="sortable">Cena</div></div>
        </div>
        {% for record in product.records %}
        <div class="record">
            <div class="service_logo_box">
                <img src="{% static "img/logo/"|add:record.bookstore|add:"_150x75.png"|lower %}" alt="{{record.bookstore}}" onerror="this.onerror=null;this.src='{% static "img/logo/loremipsum_150x75.png" %}'" />
            </div>
            <div class="record_formats">
                Dostajesz: <br/>{% for format in record.formats %}{% if forloop.first %}{{ format }}{% else %}, {{ format }}{% endif %}{% endfor %}
            </div>
            <div class="record_info">Test</div>
            <div class="payment_info">Test2</div>
            <div class="record_price">
                {{ record.price }} <b>zł</b>
                <div class="shipment">+ przesyłka od 12 zł</div>
                <a href="{{ record.url }}" target="_blank">
                    <div class="goto_shop">
                        IDŹ DO SKLEPU
                    </div>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% if product.filtered_records_number > 0 %}
        <div class="records_filtered_out">
            <div class="sd_format_info">
                {% if product.filtered_records_number == 1%}
                    Oferta 1 serwisu nie spełniła wymagań aktywnych filtrów.
                {% else %}
                    Oferty {{ product.filtered_records_number }} serwisów nie spełniły wymagań aktywnych filtrów.
                {% endif %}
                Format{% if product.filtered_formats|length > 1 %}y{% endif %} {% for format in product.filtered_formats %}{{ format }}{% if not forloop.last %}, {% endif %}{% endfor %}.
                Cena {% if product.filtered_records_number > 1%}od {% endif %}{{ product.price_lowest_before_filtering }} zł.
            </div>
        </div>
    {% endif %}
</div>

{% endwith %}
