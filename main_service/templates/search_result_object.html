{% load staticfiles %}
{% load mathtags %}
<!--{ % with product=product % }-->
{% with product=result %}

          <div class="search_list_book">
            <img src="{{ product.cover }}" alt="" style="width:100px" onerror="this.onerror=null;this.src='{% static "img/default_cover.png" %}'" />
            <div class="s_title">
              <a href="">{{ product.title }}</a>
            </div>
            <div class="s_author">
              {% for author in product.name %}{% if forloop.first %}<a href="">{{ author }}</a>{% else %}, <a href="">{{ author }}</a>{% endif %}{% endfor %}
            </div>
            <div class="s_text">
              Formaty: {% for format in product.formats %}{% if forloop.first %}{{ format }}{% else %}, {{ format }}{% endif %}{% endfor %}<br />
              Księgarnie: {% for bookstore in product.bookstore %}{% if forloop.first %}{{ bookstore }}{% else %}, {{ bookstore }}{% endif %}{% endfor %}.
            </div>
             <div class="slb_price">
              cena od:
              <div class="slb_price1">
                {{ product.price_lowest }} zł
              </div>
              <a href="">
                <div class="slb_price_btn">
                  TROP <img src="{% static "img/hand.png" %}" alt="" />
                </div>
              </a>
              <div class="slb_price_btn" onclick="list_book('{{ forloop.counter }}','{{ product.records|length }}');">
                SZCZEGÓŁY
              </div>
            </div>
          </div>
          <div class="search_drop2" id="list_book_2_{{ forloop.counter }}">
          <!--     width = liczbawierszy w dropdownie * 136 czyli ich wysokość +45 czyli szerokość szarego paska       -->
          <div class="search_drop" id="list_book{{ forloop.counter }}"
                {% if product.filtered_records == 0 %}
                    style="margin-top:-{{ product.records|length|mult:"136"|add:"35" }}px;"
                {% else %}
                    style="margin-top:-{{ product.records|length|mult:"136"|add:"35"|add:"25" }}px;"
                {% endif %}
          >

              <div class="sd_top">
                <div class="sd_top_left">
                    <div class="sort_for sort_for_long">Zabezpieczeń</div>
                    <div class="sort_for sort_for_long">Liczby formatów</div>
                    <div class="sort_for ">Ceny</div>
                    <div class="sort_for_title sort_for_long">SORTUJ WEDŁUG</div>
                </div>
                <div class="sd_top_right">
                  <div class="sort_for ">WSZYSTKIE</div>
                  <div class="sort_for ">15</div>
                  <div class="sort_for ">10</div>
                  <div class="sort_for ">5</div>
                </div>
                <div id="upper_hide{{ forloop.counter }}" class="search_drop_upper_hide_btn" onclick="list_book('{{ forloop.counter }}','{{ product.records|length }}');">
                </div>
              </div>

              {% for record in product.records %}
              <div class="sd_format">
                <img src="{% static "img/logo/"|add:record.bookstore|add:"_150x75.png"|lower %}" alt="{{record.bookstore}}" onerror="this.onerror=null;this.src='{% static "img/logo/loremipsum_150x75.png" %}'" />
                <div class="sd_format_text">
                  Dostajesz: <br/>
                  {% for format in record.formats %}{% if forloop.first %}{{ format }}{% else %}, {{ format }}{% endif %}{% endfor %}
                </div>
                <div class="sd_price">
                  {{ record.price }} <b>zł</b>
                  <a href="{{ record.url }}" target="_blank">
                    KUP
                  </a>
                </div>
              </div>
              {% endfor %}
              {% if product.filtered_records > 0 %}
              <div class="sd_format_filtered_out">
                  <div class="sd_format_info">
                  {% if product.filtered_records == 1%}
                  Oferta 1 serwisu nie spełniła wymagań aktywnych filtrów
                  {% else %}
                  Oferty {{ product.filtered_records }} serwisów nie spełniły wymagań aktywnych filtrów
                  {% endif %}
                  </div>
              </div>
              {% endif %}
            </div>
          </div>
          <div class="search_drop_hide">
            <!--  druga cyfra w onclick="list_book('1','2'); to liczba wierszy w dropdownie     -->
            <div id="hide{{ forloop.counter }}" class="search_drop_hide_btn" onclick="list_book('{{ forloop.counter }}','{{ product.records|length}}', {{product.filtered_records}});">
            </div>
          </div>
{% endwith %}
